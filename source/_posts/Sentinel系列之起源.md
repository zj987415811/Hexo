---
title: Sentinel系列之起源
date: 2018-08-28 09:24:02
tags: Sentinel
---
## 1.什么是Sentinel ##
> i.分布式系统的流量防卫兵；<br>
> ii.微服务架构中，服务与服务之间的稳定性变得越来越重要。Sentinel以流量为切入点，从流控，熔断，降级，系统负载保护等多个维度来提供服务稳定性支持；
> iii.轻量级。
## 2.Sentinel功能 ##
> i.流控，针对秒杀环境，对于突发流量可以控制在系统承受范围内；<br>
> ii.削峰填谷;<br>
> iii.实时熔断下游不可用应用;<br>
> iv.完备的监控功能:提供实时的监控功能，可以精确到秒级数据；<br>
> v.Sentinel提供简易的扩展点，快速定制逻辑，例如定制规则管理，适配数据源。
## 3.核心架构 ##
	核心库:不依赖任何框架/库，能够运行于所有java运行时环境，对Dubbo/Spring Cloud等框架有较好的支持。
	控制台:基于SpringBoot开发，打包后直接运行，不需要额外的Tomcat应用容器。
## 4.基本概念 ##
### 4.1 资源 ###
1. 资源是Sentinel的关键概念，可以是APP中的任意内容。如由应用程序提供的服务，或者由应用程序调用的其他应用提供的服务，或者一段代码。
2. 只要通过Sentinel API定义的代码就是资源，能够被Sentinel保护起来。通常使用方法签名，URL，甚至服务名称作为资源名来标识资源。
### 4.2 规则 ###
围绕资源的实时状态设定的规则，可以包括流量控制规则，熔断降级规则以及系统保护规则。所有规则可以动态实时调整。

## 5.Sentinel功能合设计理念 ##

### 5.1 流量控制 ###

**1.** **什么是流量控制**

> 流控是网络传输中的常用概念，用于调整网络包的发送数据。<br>
> 流控的目的是从系统的稳定性角度来考虑的，在处理请求的速度上，有很多讲究。<br>
> 任意时间到来的请求是随机不可控的，但是系统的处理能力有限，需要根据系统的能力进行流控。<br>
> Sentinel作为一个适配器，可以根据需要把随机请求调整成合适的形状。<br>

**2.流控设计理念**<br>
> 资源的调用关系，例如资源的调用链路，资源和资源之间的关系。<br>
> 运行指标，如QPS,线程池,系统负载等。<br>
> 控制效果，如直接限流，冷启动，排队等。<br>
> **Sentinel的设计理念是，自由选择控制的角度，进行灵活组合，达到想要的效果。**

### 5.2 熔断降级  ###

**1.什么是熔断降级**

> 核心还是保护系统稳定性，降低调用链路中的不稳定资源。由于调用关系的复杂性，如果链路中的部分资源不稳定，最终会导致请求发生堆积。<br>
> Sentinel和Hystrix原则一致：当调用链路中某个资源出现不稳定，例如表现timeout，异常比例升高的时候，则对这个资源调用进行限制，**让某个请求快速失败**，避免影响到其他资源，最终产生雪崩的效果。<br>

**2.熔断降级的设计理念**
>- 限制手段上，Sentinel和HyStrix采取不同的方法；HyStrix通过线程池的方式，来依赖(在我们的概念中对应资源)进行了隔离。这样的好处是对资源和资源之间进行彻底的隔离。缺点是增加了线程切换的成本，还需要预留资源给各个线程池大小的分配。<br>
>- Sentinel对于这个问题采用了两种手段：<br>
	1. 通过并发线程数进行限制:通过限制资源并发线程数量，来减少不稳定资源对其他资源的影响，这样没有线程切换的损耗，也不需要预先分配线程池的大小。当某个资源出现不稳定的情况下，如响应时间变长，对资源的直接影响是会造成线程数的逐步堆积。当线程数在特定资源上堆积到一定数量之后，该资源的新请求就会被拒绝，堆积的线程完成后才开始接收请求。
	2. 通过响应时间对资源进行降级：除了对并发线程数进行控制意外，Sentinel还可以通过响应时间来快速降级不稳定资源，当依赖的资源出现响应时间过长后，所有对该资源的访问都会被直接拒绝，直到过了指定时间窗口后才重新恢复。
## 5.3 系统的过载保护 ##
	系统入口流量和系统的负载达到一个平衡，保证系统在能力范围之内处理更多的请求。
## 6.Sentinel是如何工作的 ##
	1. 对主流框架提供适配或者显示的API，来定义需要保护的资源，并提供设施对资源进行实时统计和调用链路分析。
	2. 根据预设的规则，结合对资源的实时统计信息，对流量进行控制。同时，Sentinel提供开放的接口，方便定义和改变规则。
	3. Sentinel提供实时的监控系统，方便快速了解当前系统的状态。 